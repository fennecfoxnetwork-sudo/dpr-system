<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DPR System – Final One Page</title>

<style>
body{font-family:system-ui,Roboto,Arial;background:#f2f2f2;padding:10px}
h2{color:#fff;padding:10px;border-radius:6px}
.admin{background:#0d6efd}
.supervisor{background:#b02a37}
.team{background:#198754}
.box{background:#fff;padding:12px;margin-bottom:12px;border-radius:6px}
input,select,button,textarea{width:100%;padding:8px;margin:6px 0;font-size:16px}
button{cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
.hidden{display:none}
.pending{background:#fff3cd}
.approved{background:#d1e7dd}
.rejected{background:#f8d7da}
</style>
</head>

<body>

<h2 class="admin">LOGIN</h2>
<div class="box" id="loginBox">
<input id="luser" placeholder="Username">
<input id="lpass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- ADMIN -->
<div id="adminPanel" class="hidden">
<h2 class="admin">ADMIN PANEL</h2>

<div class="box">
<h3>Create User</h3>
<input id="cu" placeholder="Username">
<input id="cp" placeholder="Password">
<input id="cn" placeholder="Name">
<input id="cl" placeholder="Location">
<select id="cr">
<option value="team">Team</option>
<option value="supervisor">Supervisor</option>
</select>
<button onclick="createUser()">Create User</button>
</div>

<div class="box">
<h3>Users</h3>
<table>
<thead><tr><th>User</th><th>Role</th><th>Advance</th></tr></thead>
<tbody id="userTable"></tbody>
</table>
</div>

<button onclick="logout()">Logout</button>
</div>

<!-- SUPERVISOR -->
<div id="supervisorPanel" class="hidden">
<h2 class="supervisor">SUPERVISOR PANEL</h2>
<table>
<thead><tr><th>User</th><th>Date</th><th>Detail</th><th>Amount</th><th>Action</th></tr></thead>
<tbody id="supTable"></tbody>
</table>
<button onclick="logout()">Logout</button>
</div>

<!-- TEAM -->
<div id="teamPanel" class="hidden">
<h2 class="team">TEAM PANEL</h2>

<div class="box">
<b>Name:</b> <span id="tname"></span><br>
<b>Advance:</b> ₹<span id="bal"></span>
</div>

<div class="box">
<button onclick="showConv()">➕ Conveyance</button>
<button onclick="showExp()">➕ Expense</button>
</div>

<div class="box hidden" id="convBox">
<input type="date" id="cdate">
<input id="cfrom" placeholder="From">
<input id="cto" placeholder="To">
<input id="ctotal" type="number" placeholder="Amount">
<button onclick="saveConv()">Submit Conveyance</button>
</div>

<div class="box hidden" id="expBox">
<input type="date" id="edate">
<input id="edesc" placeholder="Description">
<input id="eamt" type="number" placeholder="Amount">
<button onclick="saveExp()">Submit Expense</button>
</div>

<div class="box">
<h3>My Entries</h3>
<table>
<thead><tr><th>Date</th><th>Detail</th><th>Amount</th><th>Status</th></tr></thead>
<tbody id="teamTable"></tbody>
</table>
</div>

<button onclick="logout()">Logout</button>
</div>

<script>
/* SAFE DOM */
const $ = id => document.getElementById(id);

let USERS = JSON.parse(localStorage.getItem("USERS")) || [
 {username:"admin",password:"admin",role:"admin",advance:0},
 {username:"sup",password:"sup",role:"supervisor",advance:0},
 {username:"team",password:"team",role:"team",advance:500}
];

let DATA = JSON.parse(localStorage.getItem("DATA")) || [];
let currentUser=null;

/* LOGIN */
function login(){
 const u = USERS.find(x=>x.username===$("luser").value && x.password===$("lpass").value);
 if(!u){alert("Wrong Login");return;}
 currentUser=u;
 $("loginBox").classList.add("hidden");

 if(u.role==="admin"){ $("adminPanel").classList.remove("hidden"); loadAdmin(); }
 if(u.role==="supervisor"){ $("supervisorPanel").classList.remove("hidden"); loadSup(); }
 if(u.role==="team"){ $("teamPanel").classList.remove("hidden"); initTeam(); }
}

function logout(){ location.reload(); }

/* ADMIN */
function createUser(){
 USERS.push({
  username:$("cu").value,
  password:$("cp").value,
  role:$("cr").value,
  advance:0
 });
 saveAll();
 loadAdmin();
}

function loadAdmin(){
 $("userTable").innerHTML="";
 USERS.forEach(u=>{
  $("userTable").innerHTML+=`<tr>
   <td>${u.username}</td><td>${u.role}</td><td>${u.advance}</td>
  </tr>`;
 });
}

/* SUPERVISOR */
function loadSup(){
 $("supTable").innerHTML="";
 DATA.forEach((d,i)=>{
  $("supTable").innerHTML+=`<tr>
   <td>${d.user}</td><td>${d.date}</td><td>${d.detail}</td><td>${d.amount}</td>
   <td>
    <button onclick="approve(${i})">Approve</button>
    <button onclick="reject(${i})">Reject</button>
   </td>
  </tr>`;
 });
}
function approve(i){ DATA[i].status="Approved"; saveAll(); loadSup(); }
function reject(i){ DATA[i].status="Rejected"; saveAll(); loadSup(); }

/* TEAM */
function initTeam(){
 $("tname").innerText=currentUser.username;
 $("bal").innerText=currentUser.advance;
 loadTeam();
}
function showConv(){ $("convBox").classList.remove("hidden"); $("expBox").classList.add("hidden"); }
function showExp(){ $("expBox").classList.remove("hidden"); $("convBox").classList.add("hidden"); }

function saveConv(){
 addEntry("Conveyance",+$("ctotal").value);
}
function saveExp(){
 addEntry("Expense - "+$("edesc").value,+$("eamt").value);
}
function addEntry(detail,amt){
 if(!amt){alert("Amount required");return;}
 DATA.push({
  user:currentUser.username,
  date:new Date().toISOString().slice(0,10),
  detail,amount:amt,status:"Pending"
 });
 currentUser.advance-=amt;
 saveAll();
 loadTeam();
}

function loadTeam(){
 $("bal").innerText=currentUser.advance;
 $("teamTable").innerHTML="";
 DATA.filter(d=>d.user===currentUser.username).forEach(d=>{
  $("teamTable").innerHTML+=`<tr class="${d.status.toLowerCase()}">
   <td>${d.date}</td><td>${d.detail}</td><td>${d.amount}</td><td>${d.status}</td>
  </tr>`;
 });
}

/* STORAGE */
function saveAll(){
 localStorage.setItem("USERS",JSON.stringify(USERS));
 localStorage.setItem("DATA",JSON.stringify(DATA));
}
</script>

</body>
</html>
