<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>DPR System â€“ Final</title>

<!-- âœ… Mobile Friendly Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Poppins',sans-serif;
  background:#f2f2f2;
  padding:10px;
  font-size:14px;
}
h2{color:#fff;padding:10px;border-radius:6px}
.admin{background:#0d6efd}
.supervisor{background:#b02a37}
.team{background:#198754}

.box{
  background:#fff;
  padding:12px;
  margin-bottom:12px;
  border-radius:8px;
}

input,select,button,textarea{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:15px;
  border-radius:6px;
  border:1px solid #ccc;
}

button{
  background:#0d6efd;
  color:#fff;
  border:none;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}
.hidden{display:none}

.pending{background:#fff3cd}
.approved{background:#d1e7dd}
.rejected{background:#f8d7da}
</style>
</head>

<body>

<h2 class="admin">LOGIN</h2>
<div class="box" id="loginBox">
<input id="luser" placeholder="Username">
<input id="lpass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div id="teamPanel" class="hidden">
<h2 class="team">TEAM PANEL</h2>

<div class="box">
<b>Name:</b> <span id="tname"></span><br>
<b>Balance:</b> â‚¹<span id="bal"></span>
</div>

<div class="box">
<input type="date" id="edate">
<input id="edesc" placeholder="Expense detail">
<input type="number" id="eamt" placeholder="Amount">
<button onclick="saveExpense()">Submit</button>
</div>

<div class="box">
<table>
<thead>
<tr><th>Date</th><th>Detail</th><th>Amount</th><th>Status</th></tr>
</thead>
<tbody id="teamTable"></tbody>
</table>
</div>

<button onclick="logout()">Logout</button>
</div>

<script>
/* ðŸ”´ PASTE YOUR GOOGLE SCRIPT URL HERE */
const API_URL = "PASTE_WEB_APP_URL_HERE";

/* DEFAULT USERS */
if(!localStorage.getItem("USERS")){
  localStorage.setItem("USERS",JSON.stringify([
    {username:"admin",password:"admin",role:"admin"},
    {username:"team",password:"team",role:"team",name:"Team",advance:0}
  ]));
}

let USERS=JSON.parse(localStorage.getItem("USERS"));
let DATA=JSON.parse(localStorage.getItem("DATA"))||[];
let currentUser=null;

/* LOGIN */
function login(){
  let u=USERS.find(x=>x.username==luser.value && x.password==lpass.value);
  if(!u) return alert("Wrong Login");
  currentUser=u;
  loginBox.classList.add("hidden");
  teamPanel.classList.remove("hidden");
  tname.innerText=u.username;
  bal.innerText=u.advance||0;
  edate.valueAsDate=new Date();
  loadTeam();
}

function logout(){location.reload();}

/* SAVE EXPENSE */
function saveExpense(){
  let obj={
    username:currentUser.username,
    role:currentUser.role,
    date:edate.value,
    detail:edesc.value,
    amount:eamt.value,
    status:"Pending",
    synced:false
  };
  DATA.push(obj);
  saveAll();
}

/* LOAD */
function loadTeam(){
  teamTable.innerHTML="";
  DATA.forEach(d=>{
    teamTable.innerHTML+=`
    <tr class="pending">
    <td>${d.date}</td>
    <td>${d.detail}</td>
    <td>${d.amount}</td>
    <td>${d.status}</td>
    </tr>`;
  });
}

/* SAVE + SYNC */
function saveAll(){
  localStorage.setItem("DATA",JSON.stringify(DATA));
  syncGoogle();
  loadTeam();
}

/* AUTO SYNC */
async function syncGoogle(){
  if(!navigator.onLine) return;
  for(let d of DATA.filter(x=>!x.synced)){
    try{
      let r=await fetch(API_URL,{method:"POST",body:JSON.stringify(d)});
      let j=await r.json();
      if(j.status=="success") d.synced=true;
    }catch(e){}
  }
  localStorage.setItem("DATA",JSON.stringify(DATA));
}

window.addEventListener("online", syncGoogle);
</script>

</body>
</html>
